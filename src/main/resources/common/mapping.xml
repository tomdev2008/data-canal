<?xml version="1.0" encoding="UTF-8"?>
<mappings xmlns="http://yunzhiyouke.com/es"
          xsi:schemaLocation="http://yunzhiyouke.com/es mapping-schema.xsd"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

    <numberOfShards>1</numberOfShards>
    <numberOfReplicas>1</numberOfReplicas>
    <!-- columnName统一表示源数据端的字段名称，fieldName统一表示ES端的索引字段名称 -->
    <mapping>
        <!-- schemaName 用于定义数据域，如：数据库名，日志类型名(runtime_log,business_log)等 -->
        <schemaName>xiyou_prod</schemaName>
        <!-- 数据库名 -->
        <!-- 默认使用以下分词器的字段列表配置，优先级低于field中定义的分词器 -->
        <defaultTokenizer>
            <ik_smart>
                school_name,department_name,class_name,student_name,create_name,contact_name,read_name,score_name,audit_name,addr,operator_name,real_name,county_name,city_name,province_name
            </ik_smart>
            <path_hierarchy>node_path</path_hierarchy>
        </defaultTokenizer>

        <collection>
            <name>cms_survey</name>
            <field>
                <columnName>TITLE</columnName>
                <mappingType>text</mappingType>
                <fieldData>true</fieldData>
            </field>
        </collection>

        <collection>
            <name>t_approval</name>
            <field>
                <columnName>apply_reason</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>apply_user_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>audit_user_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <triggers>
                <onInsert>
                    <field>
                        <insert>
                            <indexName>ext_approval</indexName>
                            <source>
                                <exportFields>apply_user_id,audit_time,apply_type,audit_status,apply_id</exportFields>
                            </source>
                            <source>
                                <indexName>xiyou_prod@t_approval_leave</indexName>
                                <exportFields>leave_start,leave_over</exportFields>
                                <condition>
                                    <eq>
                                        <columnName>apply_id</columnName>
                                        <fieldName>apply_id</fieldName>
                                    </eq>
                                </condition>
                            </source>
                        </insert>
                    </field>
                </onInsert>

                <onUpdate>
                    <field>
                        <columnName>audit_status</columnName>
                        <update>
                            <field>ext_approval.audit_status</field>
                            <condition>
                                <eq>
                                    <columnName>apply_id</columnName>
                                    <fieldName>apply_id</fieldName>
                                </eq>
                            </condition>
                        </update>
                    </field>
                </onUpdate>
            </triggers>
        </collection>

        <collection>
            <name>t_approval_internship</name>
            <field>
                <columnName>contact_tel</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>current_version</columnName>
                <mappingType>date</mappingType>
                <format>yyyy-MM-dd HH:mm:ss.SSS</format>
            </field>
            <field>
                <columnName>contact_name</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>changed_date</columnName>
                <mappingType>nested</mappingType>
                <properties>
                    <property>
                        <columnName>start</columnName>
                        <mappingType>date</mappingType>
                        <format>yyyy-MM-dd HH:mm</format>
                    </property>
                    <property>
                        <columnName>end</columnName>
                        <mappingType>date</mappingType>
                        <format>yyyy-MM-dd HH:mm</format>
                    </property>
                </properties>
                <mappingRule>
                    <!-- Java的replaceAll，源数据由fieldName对应的值提供，当fieldName留空时，源数据默认是空字符串 -->
                    <replaceAll>
                        <regex>
                            <![CDATA[\[("\d{4}\-\d{1,2}\-\d{1,2}\s{1}\d{1,2}:\d{1,2}(:\d{1,2}){0,1}"),\s*("\d{4}\-\d{1,2}\-\d{1,2}\s{1}\d{1,2}:\d{1,2}(:\d{1,2}){0,1}")\]
                            ]]>
                        </regex>
                        <replacement>
                            <![CDATA[
                            {"start":$1,"end":$3}
                            ]]>
                        </replacement>
                    </replaceAll>

                </mappingRule>
            </field>
        </collection>

        <collection>
            <name>t_approval_leave</name>
            <field>
                <columnName>task_ids</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_authentication</name>
            <field>
                <columnName>school_address</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>school_phone</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>user_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>authorization_path_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>audit_user_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_category</name>
            <field>
                <columnName>creator</columnName>
                <mappingType>text</mappingType>

            </field>
            <field>
                <columnName>name</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>updator</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
        </collection>

        <collection>
            <name>t_check</name>
            <field>
                <columnName>user_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_check_position</name>
            <field>
                <columnName>title</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
        </collection>

        <collection>
            <name>t_comment</name>
            <field>
                <columnName>content</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
                <keyword>false</keyword>
            </field>
            <field>
                <columnName>creator</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>ref_creator</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_early_warning_detail</name>
            <field>
                <columnName>student_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_early_warning_counts</name>
            <field>
                <columnName>user_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_early_warning_record</name>
            <field>
                <columnName>user_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_internship_base</name>
            <field>
                <columnName>addr</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>contact_tel</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>contact_email</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>organization_code</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>name</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
        </collection>

        <collection>
            <name>t_internship_journal</name>
            <field>
                <columnName>title</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
                <keyword>true</keyword>
            </field>
            <field>
                <columnName>comment</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
                <keyword>false</keyword>
            </field>
            <field>
                <columnName>student_id</columnName>
                <mappingType>text</mappingType>
                <keyword>false</keyword>
            </field>
            <field>
                <columnName>content</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
                <fieldData>true</fieldData>
                <keyword>false</keyword>
            </field>
            <field>
                <columnName>pic_urls</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>
        <collection>
            <name>t_internship_mode</name>
            <field>
                <columnName>node_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>
        <collection>
            <name>t_internship_results</name>
            <field>
                <columnName>student_id</columnName>
                <mappingType>text</mappingType>
                <keyword>false</keyword>
            </field>
        </collection>

        <collection>
            <name>t_internship_summary</name>
            <field>
                <columnName>title</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>student_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>content</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_internship_type</name>
            <field>
                <columnName>title</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>name</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>create_user_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>update_user_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_message_content</name>
            <field>
                <columnName>title</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>content</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
                <keyword>false</keyword>
            </field>
            <field>
                <columnName>creator_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_message_receive</name>
            <field>
                <columnName>receiver</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_message_send</name>
            <field>
                <columnName>sender</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_node</name>
            <field>
                <columnName>manager_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>creator_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>creator_name</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>updator_name</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>node_code</columnName>
                <mappingType>keyword</mappingType>
            </field>

            <field>
                <columnName>node_title</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
        </collection>

        <collection>
            <name>t_remind_log</name>
            <field>
                <columnName>student_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_schedule_job</name>
            <field>
                <columnName>params</columnName>
                <mappingType>text</mappingType>
                <keyword>false</keyword>
            </field>
            <field>
                <columnName>remark</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_schedule_job_log</name>
            <field>
                <columnName>params</columnName>
                <mappingType>text</mappingType>
                <keyword>false</keyword>
            </field>
        </collection>

        <collection>
            <name>t_school_settings</name>
            <field>
                <columnName>svalue</columnName>
                <mappingType>text</mappingType>
                <keyword>false</keyword>
            </field>
        </collection>

        <collection>
            <name>t_score</name>
            <field>
                <columnName>student_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>score_role</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_settings</name>
            <field>
                <columnName>svalue</columnName>
                <mappingType>text</mappingType>
                <keyword>false</keyword>
            </field>
        </collection>

        <collection>
            <name>t_sign</name>
            <field>
                <columnName>student_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>phone_uuid</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>province</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>city</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>district</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>street</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>audit_user</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_sign_bind</name>
            <field>
                <columnName>student_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>sign_name</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>audit_user</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>province</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>city</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>district</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
            <field>
                <columnName>street</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
            </field>
        </collection>

        <collection>
            <name>t_sign_change_log</name>
            <field>
                <columnName>student_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>old_uuid</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>new_uuid</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>
        <collection>
            <name>t_sign_equipment</name>
            <field>
                <columnName>student_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>phone_uuid</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>os_version</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>phone_model</columnName>
                <mappingType>keyword</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_student</name>
            <field>
                <columnName>user_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>grade</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>sid</columnName>
                <mappingType>keyword</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_sys_menu_package</name>
            <field>
                <columnName>description</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_sys_menu_permissions</name>
            <field>
                <columnName>prep_permissions_ids</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_sys_role</name>
            <field>
                <columnName>update_user_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>create_user_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>role_desc</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_sys_user</name>
            <field>
                <columnName>id_card</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>email</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>mobile</columnName>
                <mappingType>keyword</mappingType>
            </field>
            <field>
                <columnName>node_ids</columnName>
                <mappingType>keyword</mappingType>
            </field>
            <field>
                <columnName>nickname</columnName>
                <mappingType>keyword</mappingType>
            </field>
            <field>
                <columnName>username</columnName>
                <mappingType>keyword</mappingType>
            </field>

            <triggers>
                <onUpdate>
                    <field>
                        <columnName>real_name</columnName>
                        <update>
                            <field>ext_task_student.real_name</field>
                            <condition>
                                <eq>
                                    <columnName>user_id</columnName>
                                    <fieldName>student_id</fieldName>
                                </eq>
                            </condition>
                        </update>
                    </field>
                    <field>
                        <columnName>status</columnName>
                        <update>
                            <field>ext_task_student.user_status</field>
                            <condition>
                                <eq>
                                    <columnName>user_id</columnName>
                                    <fieldName>student_id</fieldName>
                                </eq>
                            </condition>
                        </update>
                    </field>

                </onUpdate>
            </triggers>
        </collection>

        <collection>
            <name>t_sys_user_role</name>
            <field>
                <columnName>user_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_syslog*</name>
            <field>
                <columnName>ref_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>operator_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <field>
                <columnName>operator_name</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_task_group</name>
            <field>
                <columnName>group_name</columnName>
                <mappingType>text</mappingType>
                <tokenizer>ik_smart</tokenizer>
                <keyword>true</keyword>
            </field>
        </collection>

        <collection>
            <name>t_task_student</name>
            <field>
                <columnName>student_num</columnName>
                <mappingType>keyword</mappingType>
            </field>
            <field>
                <columnName>attaches</columnName>
                <mappingType>text</mappingType>
            </field>
            <triggers>
                <onInsert>
                    <field>
                        <insert>
                            <indexName>ext_task_student</indexName>
                            <source>
                                <exportFields>task_id,student_id,version</exportFields>
                            </source>
                            <source>
                                <indexName>xiyou_prod@t_sys_user</indexName>
                                <exportFields>node_ids,user_type,real_name,status as user_status,school_id</exportFields>
                                <condition>
                                    <eq>
                                        <columnName>student_id</columnName>
                                        <fieldName>user_id</fieldName>
                                    </eq>
                                </condition>
                            </source>
                            <source>
                                <indexName>xiyou_prod@t_node</indexName>
                                <exportFields>node_path</exportFields>
                                <condition>
                                    <eq>
                                        <columnName>node_ids</columnName>
                                        <fieldName>id</fieldName>
                                    </eq>
                                </condition>
                            </source>

                            <source>
                                <indexName>xiyou_prod@t_task</indexName>
                                <exportFields>status as task_status,type_id</exportFields>
                                <condition>
                                    <eq>
                                        <columnName>task_id</columnName>
                                        <fieldName>id</fieldName>
                                    </eq>
                                </condition>
                            </source>

                            <source>
                                <indexName>xiyou_prod@t_task_config_detail</indexName>
                                <exportFields>map_concat(plugin_key,config_detail) as config_detail</exportFields>
                                <condition>
                                    <eq>
                                        <columnName>task_id</columnName>
                                        <fieldName>task_id</fieldName>
                                    </eq>
                                    <eq>
                                        <columnName>version</columnName>
                                        <fieldName>version</fieldName>
                                    </eq>
                                </condition>
                            </source>

                            <source>
                                <indexName>xiyou_prod@t_task_config</indexName>
                                <exportFields>task_time_range,mode_id,base_id,tutor_id</exportFields>
                                <condition>
                                    <eq>
                                        <columnName>task_id</columnName>
                                        <fieldName>task_id</fieldName>
                                    </eq>
                                    <eq>
                                        <columnName>version</columnName>
                                        <fieldName>version</fieldName>
                                    </eq>
                                </condition>
                            </source>
                        </insert>
                    </field>
                </onInsert>

                <onUpdate>
                    <field>
                        <columnName>version</columnName>
                        <update>
                            <field>ext_task_student.version</field>
                            <condition>
                                <eq>
                                    <columnName>task_id</columnName>
                                    <fieldName>task_id</fieldName>
                                </eq>
                                <eq>
                                    <columnName>version</columnName>
                                    <fieldName>version</fieldName>
                                </eq>
                            </condition>
                        </update>
                    </field>
                </onUpdate>
            </triggers>
        </collection>

        <collection>
            <name>t_teacher</name>
            <field>
                <columnName>employee_id</columnName>
                <mappingType>keyword</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_thumb_up</name>
            <field>
                <columnName>ref_id</columnName>
                <mappingType>keyword</mappingType>
            </field>
            <field>
                <columnName>ref_creator</columnName>
                <mappingType>keyword</mappingType>
            </field>
            <field>
                <columnName>comment_object_type</columnName>
                <mappingType>keyword</mappingType>
            </field>
            <field>
                <columnName>comment_object</columnName>
                <mappingType>keyword</mappingType>
            </field>

        </collection>

        <collection>
            <name>t_upload_resources</name>
            <field>
                <columnName>biz_id</columnName>
                <mappingType>keyword</mappingType>
            </field>
            <field>
                <columnName>res_path</columnName>
                <mappingType>text</mappingType>
                <tokenizer>standard</tokenizer>
            </field>
            <field>
                <columnName>lisit_path</columnName>
                <mappingType>text</mappingType>
                <tokenizer>standard</tokenizer>
            </field>

        </collection>

        <collection>
            <name>t_version</name>
            <field>
                <columnName>create_user_id</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_system_plug_config</name>
            <field>
                <columnName>configurable_item</columnName>
                <mappingType>text</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_task</name>
            <field>
                <columnName>node_id</columnName>
                <mappingType>text</mappingType>
            </field>
            <triggers>
                <onUpdate>
                    <field>
                        <columnName>status</columnName>
                        <update>
                            <field>ext_task_student.task_status</field>
                            <condition>
                                <eq>
                                    <columnName>id</columnName>
                                    <fieldName>task_id</fieldName>
                                </eq>
                            </condition>
                        </update>
                    </field>
                </onUpdate>
            </triggers>
        </collection>

        <collection>
            <name>t_task_config</name>
            <field>
                <columnName>tutor_id</columnName>
                <mappingType>keyword</mappingType>
            </field>
            <field>
                <columnName>contact_tel</columnName>
                <mappingType>keyword</mappingType>
            </field>
            <field>
                <columnName>address</columnName>
                <mappingType>keyword</mappingType>
            </field>
        </collection>

        <collection>
            <name>t_feedback</name>
            <field>
                <columnName>contact</columnName>
                <mappingType>keyword</mappingType>
            </field>
        </collection>

    </mapping>

    <!-- 这里是业务日志数据域 -->
    <mapping>
        <schemaName>business_log</schemaName>
        <!-- 日志类型名 -->
    </mapping>

</mappings>